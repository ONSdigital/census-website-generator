{% extends "_master.html" %}

{% from "components/panel/_macro.njk" import onsPanel %}
{% from "components/collapsible/_macro.njk" import onsCollapsible %}
{% from "components/related-links/_macro.njk" import onsRelatedLinks %}

{% import "partials/helpers.html" as helpers %}

{% block pageContent %}
    {% if helpMetaData.metadata.surveyType === "paper" %}
        {% include "partials/globalCta.html" %}
    {% endif %}

    <div class="page__container container">
        {% include "partials/breadcrumbs.html" %}

        <div class="grid u-mt-s">
            <div class="grid__col col-7@m">
                <main id="main-content" role="main" class="page__main u-mt-no">
                    <h1 class="u-mb-l u-fs-xxl">{% if helpMetaData.metadata.prefix %}{{ helpMetaData.metadata.prefix }}. {% endif %}{{ entry.title }}</h1>
                    {% if helpMetaData.metadata.surveyType is defined %}
                        {% if helpMetaData.metadata.surveyType === "online" %}
                            {% set guidancePanelText = guidancePanel.paper.text %}
                            {% set guidancePanelLinkText = guidancePanel.paper.linkText %}                      
                        {% elif helpMetaData.metadata.surveyType === "paper" %}
                            {% set guidancePanelText = guidancePanel.online.text %}
                            {% set guidancePanelLinkText = guidancePanel.online.linkText %}                      
                        {% endif %}
                        {% call onsPanel({ "classes": "u-mb-l", "type": "branded" }) %}
                            <p>{{ guidancePanelText|safe }} <a href="{{ helpMetaData.url }}">{{ guidancePanelLinkText }}</a>.</p>
                        {% endcall %}                        
                    {% endif %}
                    <section class="page__body">
                        {% if helpMetaData.metadata.whyWeAsk %}
                            {{
                                onsCollapsible({
                                    "id": "details",
                                    "classes": "u-mb-s",
                                    "title": global.strings.whyWeAskThis,
                                    "content": helpMetaData.metadata.whyWeAsk,
                                    "summaryAttributes": {
                                        "data-ga-category": "Why we ask this question",
                                        "data-ga-label": contentBlock.definition.title
                                    },
                                    "button": {
                                        "close": global.strings.hideThis
                                    }
                                })
                            }}
                        {% endif %}

                        {{ entry.body|safe }}

                        {% if entry.content %}
                            {% for contentBlock in entry.content %}
                                {% set block = contentBlock %}
                                {% include "partials/pageContent/" + block.typeHandle + ".html" %}
                            {% endfor %}
                        {% endif %}
                    </section>
                </main>
            </div>

            <div class="grid__col col-4@m push-1@m u-mt-m">
                {{-
                    onsRelatedLinks({
                        "id": "related-list-block",
                        "title": "Related Content"|localize,
                        "itemsList": entry.relatedLinks
                    }) 
                }}
            </div>
        </div>
    </div>
{% endblock %}
