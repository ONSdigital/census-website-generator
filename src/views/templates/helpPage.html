{% extends "partials/_master.html" %}

{% from "components/breadcrumb/_macro.njk" import onsBreadcrumb %}
{% from "components/toc/_macro.njk" import onsTableOfContents %}
{% from "components/lists/_macro.njk" import onsList %}
{% from "components/panel/_macro.njk" import onsPanel %}
{% from "components/details/_macro.njk" import onsDetails %}
{% from "components/related-links/_macro.njk" import onsRelatedLinks %}
{% from "components/downloads/_macro.njk" import onsDownloads %}
{% from "components/video/_macro.njk" import onsVideo %}
{% from "components/images/_macro.njk" import onsImage %}
{% block page %}
    <div class="page__container container">
        {{ 
            onsBreadcrumb({
                "ariaLabel": gStrings.bcrumb,
                "itemsList": breadcrumbs
            })
        }}
        <div class="grid u-mt-s@m">
            <div class="grid__col col-7@m">
                <main id="main-content" role="main" class="page__main {{ pageClasses }}">
                    <h1 class="u-mb-l u-fs-xxl">{% if helpMetaData.prefix %}{{ helpMetaData.prefix }}. {% endif %}{{ title }}</h1>
                    {% if helpMetaData.surveyType is defined %}
                        {% if helpMetaData.surveyType === 'online' %}
                            {% set guidancePanelText = guidancePanel.paper.text %}
                            {% set guidancePanelLinkText = guidancePanel.paper.linkText %}                      
                        {% elif helpMetaData.surveyType === 'paper' %}
                            {% set guidancePanelText = guidancePanel.online.text %}
                            {% set guidancePanelLinkText = guidancePanel.online.linkText %}                      
                        {% endif %}
                        {% call onsPanel({
                                "classes": 'u-mb-l',
                                "type": "branded"
                            }) %}
                            <p>{{ guidancePanelText | safe }} <a href="{{ helpMetaData.url }}">{{ guidancePanelLinkText }}</a>.</p>
                        {% endcall %}                        
                    {% endif %}
                    <section class="section">
                        {% if helpMetaData.whyWeAsk %}
                            {{
                                onsDetails({
                                    "id": 'details',
                                    "classes": 'u-mb-s',
                                    "title": gStrings.whyWeAskThis,
                                    "content": helpMetaData.whyWeAsk,
                                    "button": {
                                        "close": gStrings.hideThis
                                    }
                                })
                            }}
                        {% endif %}
                        {% if content %}
                            {% for contentBlock in content %}
                                {% if contentBlock.mainBody %}
                                    {{ contentBlock.mainBody | safe }}
                                {% endif %}
                                {% if contentBlock.panel %}
                                    {{ 
                                        onsPanel({
                                            "body": contentBlock.panel.body,
                                            "classes": 'u-mb-m'
                                        })
                                    }}
                                {% elif contentBlock.definition %}
                                    {{
                                        onsDetails({
                                            "id": 'details',
                                            "classes": 'u-mb-m',
                                            "title": contentBlock.definition.title,
                                            "content": contentBlock.definition.content,
                                            "button": {
                                                "close": gStrings.hideThis
                                            }
                                        })
                                    }}
                                {% elif contentBlock.body %}
                                    {{ contentBlock.body.content | safe }}
                                {% elif contentBlock.image %}
                                    <div class="u-mb-m">
                                        {{ 
                                            onsImage({
                                                "url": '/' + contentBlock.image.url,
                                                "alt": contentBlock.image.altText,
                                                "caption": contentBlock.image.caption
                                            })
                                        }}
                                    </div>
                                {% elif contentBlock.downloads %}
                                    {{ 
                                        onsDownloads({
                                        "classes": "u-mb-m",
                                        "downloads": contentBlock.downloads
                                    }) 
                                }}   
                                {% elif contentBlock.video %}
                                    <div class="u-mb-m">
                                        {{ 
                                            onsVideo({
                                                "youtubeUrl": contentBlock.video.youtubeUrl
                                            })
                                        }}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </section>
                </main>
            </div>  
            <div class="grid__col col-4@m push-1@m u-mt-m">
                {{-
                    onsRelatedLinks({
                        "id": 'related-list-block',
                        "title": gStrings.relatedContent,
                        "itemsList": relatedLinks
                    }) 
                }}
            </div>
        </div>
    </div>
{% endblock %}
